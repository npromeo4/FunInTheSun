---
- name : "play 1: testing RESTCONF"
  hosts: routers
  connection: ansible.netcommon.httpapi
  gather_facts: false
  tasks:
    - name: "Grab all VRFs from device"
      uri:
        url: "https://{{ ansible_host }}/restconf/data/Cisco-IOS-XE-native:native/Cisco-IOS-XE-native:vrf"
        user: "{{ ansible_user }}"
        password: "{{ ansible_password }}"
        method: GET
        return_content: true
        headers:
          Accept: "application/yang-data+json"
        validate_certs: false
      register: result

    - name: "Refine variable"
      set_fact:
        vrf_data: "{{ result['json']['Cisco-IOS-XE-native:vrf']['definition'] }}"

#    - name: "Print Result"
#      debug:
#        msg: "{{ result.json }}"

    - name: "Loop through VRFs"
      set_fact:
        cust_vrf: "{{ item.name }}"
      loop: "{{ vrf_data }}"
      when: item.rd is defined

    - name: "Print customer VRFs"
      ansible.builtin.debug:
        var: cust_vrf










#    - name: "Grab all interfaces from device"
#      uri:
#        url: "https://{{ ansible_host }}/restconf/data/Cisco-IOS-XE-vrf-oper:vrf-oper-data"
#        user: "{{ ansible_user }}"
#        password: "{{ ansible_password }}"
#        method: GET
#        return_content: true
#        headers:
#          Accept: "application/yang-data+json"
#        validate_certs: false
#      register: result
#
#    - name: "Print Result"
#      debug:
#        msg: "{{ result.json }}"
#
